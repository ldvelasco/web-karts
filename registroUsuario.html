<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro de Usuario - Karts</title>
</head>
<body>

    <h1>游닇 Crear Nueva Cuenta (KARTS-SEG-002)</h1>
    <hr>

    <div id="message-box" style="display: none; margin-bottom: 15px; font-weight: bold;"></div>

    <form id="register-form">
        <fieldset>
            <legend>Datos Personales</legend>
            
            <label for="fullName">Nombre Completo:</label><br>
            <input type="text" id="fullName" name="fullName" required placeholder="Tu nombre y apellido" style="width: 250px;">
            <br><br>

            <label for="email">Correo Electr칩nico:</label><br>
            <input type="email" id="email" name="email" required placeholder="usuario@email.com" style="width: 250px;">
            <br><br>

            <label for="password">Contrase침a:</label><br>
            <input type="password" id="password" name="password" required placeholder="M칤nimo 6 caracteres" minlength="6" style="width: 250px;">
            <br><br>

            <label for="confirmPassword">Confirmar Contrase침a:</label><br>
            <input type="password" id="confirmPassword" name="confirmPassword" required placeholder="Repite la contrase침a" style="width: 250px;">
            <br><br>

            <button type="submit" id="btn-submit" style="padding: 10px 20px; cursor: pointer;">REGISTRARSE</button>
        </fieldset>
    </form>

    <p><small>쯏a tienes cuenta? <a href="index.html">Inicia sesi칩n aqu칤</a></small></p>

<script>
    /**
     * CONFIGURACI칍N
     * Apunta al endpoint de registro del Backend.
     */
    const API_REGISTER_URL = 'http://localhost:3000/api/auth/register';

    // Elementos DOM
    const form = document.getElementById('register-form');
    const msgBox = document.getElementById('message-box');
    const btnSubmit = document.getElementById('btn-submit');

    /**
     * L칍GICA DE REGISTRO
     */
    form.addEventListener('submit', async (e) => {
        e.preventDefault();

        // 1. Obtener valores
        const name = document.getElementById('fullName').value;
        const email = document.getElementById('email').value;
        const pass = document.getElementById('password').value;
        const confirmPass = document.getElementById('confirmPassword').value;

        // 2. Validaci칩n Frontend: 쮺oinciden las contrase침as?
        if (pass !== confirmPass) {
            showMessage("Las contrase침as no coinciden.", "red");
            return;
        }

        // 3. Preparar UI (Bloquear bot칩n)
        btnSubmit.disabled = true;
        btnSubmit.textContent = "Creando cuenta...";
        showMessage("", "black", false); // Limpiar mensajes

        try {
            // 4. Petici칩n POST al Backend
            const response = await fetch(API_REGISTER_URL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    name: name,
                    email: email,
                    password: pass
                })
            });

            // 5. Manejar respuesta
            const data = await response.json();

            if (!response.ok) {
                throw new Error(data.message || 'Error al registrar usuario');
            }

            // 6. 칄XITO
            showMessage("춰Cuenta creada con 칠xito! Redirigiendo al login...", "green");
            
            // Esperar 2 segundos y mandar al Login
            setTimeout(() => {
                window.location.href = 'index.html'; // O login.html seg칰n como lo llamaste
            }, 2000);

        } catch (error) {
            // 7. Error
            let errorText = error.message;
            if (errorText === 'Failed to fetch') {
                errorText = "No hay conexi칩n con el servidor.";
            }
            showMessage("丘멆잺 " + errorText, "red");
            
            // Restaurar bot칩n
            btnSubmit.disabled = false;
            btnSubmit.textContent = "REGISTRARSE";
        }
    });

    // Funci칩n auxiliar para mensajes
    function showMessage(text, color, visible = true) {
        msgBox.textContent = text;
        msgBox.style.color = color;
        msgBox.style.display = visible ? 'block' : 'none';
    }

</script>
</body>
</html>